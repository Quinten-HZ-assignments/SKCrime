<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="/libs/Leaflet/leaflet.css" />
	<link rel="stylesheet" type="text/css" href="/assets/style.css">
	<title>SKCrime</title>
</head>

<body>
	<nav>
		<div id="title">
			<div class="container">
				<span class="logo">
					<b>SK</b><i><b>C</b>rime</i>
				</span>
				<span class="authorization">Login</span>
			</div>
		</div>
		<ul id="menu">
			<div class="container">
				<li><a class="active" href="index.html">Dashboard</a></li>
				<li><a href="map.html">Map</a></li>
				<li><a href="about.html">About</a></li>
			</div>
		</ul>
	</nav>

	<main>
		<div class="container">

			<input type="text" class="search-bar" placeholder="ðŸ”Ž Search here">

			<div class="layout">

				<div class="layout-sidebar">
					<div id="map"></div>

					<h2 class="sidebar-title">Time Frame:</h2>
					<input type="date">
					<span> - </span>
					<input type="date">

					<br><br>

					<h2 class="sidebar-title">Crime Type:</h2>

					<label class="sidebar-checkbox">
						<input type="checkbox">
						<span>Cannabis</span>
					</label>

					<label class="sidebar-checkbox">
						<input type="checkbox">
						<span>Cocaine</span>
					</label>

					<label class="sidebar-checkbox">
						<input type="checkbox">
						<span>Ecstasy</span>
					</label>

					<label class="sidebar-checkbox">
						<input type="checkbox">
						<span>Ketamine</span>
					</label>

					<label class="sidebar-checkbox">
						<input type="checkbox">
						<span>Heroin</span>
					</label>

					<label class="sidebar-checkbox">
						<input type="checkbox">
						<span>Other</span>
					</label>

					<br>

					<small>Found articles: <b>24</b> | Total articles: <b>124</b> | Last update: <b>23:11</b></small>
					<br>
					<small>Maps provided by <b><a href="http://maps.stamen.com/">Stamen</a></b></small>
				</div>

				<div class="articles-container"></div>
				<div class="articles-container"></div>
			</div>

		</div>
	</main>

	<footer>
		Copyright Â© 2021 SKC Team. All rights reserved.
	</footer>

	<script src="/libs/DayJS/dayjs.min.js"></script>
	<script src="/libs/Leaflet/leaflet-src.js"></script>
	<script src="/assets/utils.js"></script>
	<script src="/assets/dashboard.js"></script>

	<script>

		async function init() {
			const articles = await GET('/api/articles');
			const containers = document.querySelectorAll('.articles-container');

			// Clean containers
			containers.forEach((container) => {
				container.innerHTML = '';
			});

			// Create articles elements
			let articlesElements = [];
			articlesElements = articles.map((article) => createArticleElement(article));

			// Add to the page
			articlesElements.forEach((element) => {
				let smallestContainer = 0;
				let smallestContainerHeight = 0;

				containers.forEach((container, index) => {
					if (container.clientHeight > smallestContainerHeight) {
						smallestContainer = index;
						smallestContainerHeight = container.clientHeight;
					}
					console.log(container.clientHeight);
				});

				containers[smallestContainer].appendChild(element);
			});
		}

		function createArticleElement(article) {
			const element = document.createElement('div');
			element.className = 'article';
			element.onclick = () => window.open(article.url);

			const header = document.createElement('div');
			header.className = 'article-header';

			if (article.publisher) {
				if (article.publisherInitials) {
					const authorIcon = document.createElement('div');
					authorIcon.className = 'article-author-icon';
					authorIcon.innerText = article.publisherInitials;
					header.appendChild(authorIcon);
				}

				const author = document.createElement('div');
				author.className = 'article-author';
				author.innerText = article.publisher;
				header.appendChild(author);
			}

			const date = document.createElement('div');
			date.className = 'article-date';
			date.innerText = dayjs(article.date).format('HH:mm DD/MM/YYYY');
			header.appendChild(date);

			element.appendChild(header);

			const body = document.createElement('div');
			body.className = 'article-body';

			const title = document.createElement('h1');
			title.className = 'article-title';
			title.innerText = article.title;
			body.appendChild(title);

			const description = document.createElement('p');
			description.className = 'article-description';
			description.innerText = article.description;
			body.appendChild(description);

			element.appendChild(body);

			if (article.image) {
				const image = document.createElement('div');
				image.className = 'article-image';
				image.style.backgroundImage = `url(${article.image})`;
				element.appendChild(image);

				const footer = document.createElement('div');
				footer.className = 'article-footer';
				element.appendChild(footer);
			}

			return element;
		}

		init();
	</script>

</body>

</html>
